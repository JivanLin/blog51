<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="__LAYUI__/layui-v2.6.8/css/layui.css" media="all">
    <link rel="stylesheet" href="__LAYUI__/style/admin.css" media="all">
    <script type="text/javascript" src="__STATIC__/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="__STATIC__/function.js"></script>
    <script type="text/javascript" src="__LAYUI__/layui/layui.js"></script>
</head>
<body>
    <div class="layui-fluid">
        <div class="layui-card my-card">
            <form class="layui-form my-layui-form layui-card-body" lay-filter="layuiadmin-form-useradmin" id="layuiadmin-form-useradmin">
                <input type="text" class="layui-input" style="display: none" name="id" value="{$data.id|default = 0}">
                <div class="layui-form-item">
                    <label class="layui-form-label">* 文章标题：</label>
                    <div class="layui-input-inline" style="width: 360px">
                        <input type="text" class="layui-input" autocomplete="off" name="title" value="{$data.title|default = ''}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">* 文章描述：</label>
                    <div class="layui-input-inline" style="width: 420px">
                        <input type="text" class="layui-input" autocomplete="off" name="describe" value="{$data.describe|default = ''}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">* 文章内容：</label>
                    <div class="layui-input-inline" style="width: 60%">
                        <textarea id="content" name="content" style="display: none;"></textarea>
                    </div>
                </div>
                <div class="layui-form-item layui-layout-admin">
                    <div class="layui-input-block">
                        <div class="layui-footer" style="left: 0;">
                            <button type="button" id="submit" class="layui-btn layui-btn-sm"  lay-submit lay-filter="formDemo"> 保 存 </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        function resize(){
            var h=window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
            document.getElementById("layuiadmin-form-useradmin").style.height = h-70 +"px";
            window.onresize = function(){
                var h=window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
                document.getElementById("layuiadmin-form-useradmin").style.height = h-70+"px";
            }
        }
        resize();

        layui.use(['table','form','layedit'], function(){
            var table = layui.table,
                form = layui.form,
                layedit = layui.layedit;

            //富文本编辑器 layui.layedit
            $("#content").val("{$data.content|default = ''}"); //先赋值在创建
            var content = layedit.build('content', {
                tool: [
                    'strong', 'italic', 'underline', 'del'
                    ,'|'
                    ,'left', 'center', 'right'
                    ,'|'
                    ,'link', 'unlink', 'face', 'image'
                    ,'|'
                    ,'code'
                ]
            });

            //监听提交
            form.on('submit(formDemo)', function(data){
                data.field.content = layedit.getContent(content);
                delete data.field.file; //参数为layedit编辑器自带
                // console.log(data.field);
                $.ajax({
                    url: "{:url('@admin/article/addArticleAction')}"
                    ,type: "POST"
                    ,data: data.field
                    ,dataType: "json"
                    ,async: false
                    ,success: function (re){
                        layer.open({
                            type: 1,
                            title:false,
                            closeBtn: 0,
                            shadeClose: true,
                            content:'<p style="margin:15px 30px;">'+re.msg+'</p>',
                            end:function(){
                                if(re.state){
                                    var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                    parent.layer.close(index); //再执行关闭
                                    parent.window.location.reload();
                                }
                            }
                        });
                    }
                });
            });

        });
    </script>
</body>
</html>